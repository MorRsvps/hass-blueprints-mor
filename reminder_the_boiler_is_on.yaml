# 
# Home Assistant Automation Blueprint
#
# Sends two notifications that the boiler is still turnd on
#
# Revision 2
# Mor Briga, Jan. 2021
#

blueprint:
  name: התראה שהדוד דולק
  description: התראה על דוד דולק מספר דקות
  domain: automation
  input: 
    contact_sensor: 
      name: בחירת מפסק
      description: 'המפסק שעליו נרצה לקבל התראה'
      selector: 
        entity:
          domain: switch
    first_timer:
      name: 'טיימר ראשון'
      description: 'זמן התראה לאחר מספר דקות.'
      default: 15
      selector: 
        number:
          min: 1
          step: 1
          max: 60
          mode: slider
    second_timer:
      name: 'טיימר שני'
      description: 'זמן התראה שני לאחר מספר דקות.'
      default: 30
      selector: 
        number:
          min: 1
          step: 1
          max: 60
          mode: slider
    device_identifier:
      name: המכשיר שאליו תתקבל ההתראה
      description: >
        המכשיר שמקבל את ההתראה חייב להיות מותקן את האפליקציה הרישמית של HS
      selector: 
        device:
          integration: mobile_app

# We will have two triggers, for the two different reminders. 
# However, a reminder will be ignored if the door or window is already closed by then. 
trigger:
- platform: state
  entity_id: !input בחירת_מפסק
  from: 'off'
  to: 'on'
  for:
    hours: 0
    minutes: !input טיימר_ראשון
    seconds: 0
- platform: state
  entity_id: !input בחירת_מפסק
  from: 'off'
  to: 'on'
  for:
    hours: 0
    minutes: !input טיימר_שני
    seconds: 0

# Two conditions:
# 1. The door or window should still be open. 
# 2. The temperature reading must be below the set value. 
condition:
- condition: state
  entity_id: !input בחירת_מפסק
  state: 'on'
- condition: numeric_state
  entity_id: weather.pihome
  attribute: temperature
  below: !input temperature

# Send a notification to the mobile device. 
action:
- device_id: !input device_identifier
  domain: mobile_app
  type: notify
  message: 'Time to close {{trigger.to_state.attributes.friendly_name}}.'
  title: 'Close {{trigger.to_state.attributes.friendly_name}}!'

mode: single
